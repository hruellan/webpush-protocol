<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Generic Event Delivery Using HTTP Push </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>
  <style type="text/css">
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}

@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

body {
  font: 11pt cambria, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 1em auto;
  max-width: 700px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: candara, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
}
.title { font-size: 150%; }
h1 { font-size: 130%; }
h2 { font-size: 120%; }
h3, h4 { font-size: 110%; }
ul.toc >li { font-size: 95%; }
ul.toc >li >ul, .figure, caption { font-size: 90%; }

table {
  margin-left: 0em;
}
table.header {
  width: 100%;
}

table.header td {
  background-color: inherit;
  color: black;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}

pre.text, pre.text2 {
  width: 90%;
}

dt {
  float: left; clear: left;
  margin: 0.5em 0.5em 0 0;
}
dt:first-child {
  margin-top: 0;
}
dd {
  margin: 0.5em 0 0 2em;
}
dd p, dd ul {
  margin-top: 0; margin-bottom: 0;
}
dd *+p {
  margin-top: 0.5em;
}

ol, ul {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
ul.toc, ul.toc ul { 
  margin: 0 0 0 1.5em;
}
ul.toc a:first-child { 
  display: inline-block; 
  min-width: 1.2em;
}  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Conventions and Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Overview"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 HTTP Resources"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Subscribing for Push Messages"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Subscribing for Push Message Receipts"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Requesting Push Message Delivery"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Requesting Push Message Receipts"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Push Message Time-To-Live"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Receiving Push Messages"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Acknowledging Push Messages"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Receiving Push Message Receipts"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Operational Considerations"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Load Management"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Push Message Expiration"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Subscription Expiration"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Implications for Application Reliability"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Confidentiality from Push Service Access"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Privacy Considerations"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Authorization"/>
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Denial of Service Considerations"/>
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 Logging Risks"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Header Field Registrations"/>
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Link Relation URNs"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="11 References"/>
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Change Log"/>
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Since draft-ietf-webpush-protocol-00"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.0 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M., Damaggio, E., and B. Raymor, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-webpush-protocol-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-10-16" />
  <meta name="dct.abstract" content="A simple protocol for the delivery of realtime events to user agents is described.  This scheme uses HTTP/2 server push.  " />
  <meta name="description" content="A simple protocol for the delivery of realtime events to user agents is described.  This scheme uses HTTP/2 server push.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">WEBPUSH</td>
  <td class="right">M. Thomson</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Mozilla</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">E. Damaggio</td>
</tr>
<tr>
  <td class="left">Expires: April 18, 2016</td>
  <td class="right">B. Raymor, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Microsoft</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">October 16, 2015</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Generic Event Delivery Using HTTP Push <br />
  <span class="filename">draft-ietf-webpush-protocol-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>A simple protocol for the delivery of realtime events to user agents is described.  This scheme uses HTTP/2 server push.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 18, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Conventions and Terminology</a></li>
</ul><li>2.   <a href="#rfc.section.2">Overview</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">HTTP Resources</a></li>
</ul><li>3.   <a href="#rfc.section.3">Subscribing for Push Messages</a></li>
<li>4.   <a href="#rfc.section.4">Subscribing for Push Message Receipts</a></li>
<li>5.   <a href="#rfc.section.5">Requesting Push Message Delivery</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Requesting Push Message Receipts</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Push Message Time-To-Live</a></li>
</ul><li>6.   <a href="#rfc.section.6">Receiving Push Messages</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Acknowledging Push Messages</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Receiving Push Message Receipts</a></li>
</ul><li>7.   <a href="#rfc.section.7">Operational Considerations</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Load Management</a></li>
<li>7.2.   <a href="#rfc.section.7.2">Push Message Expiration</a></li>
<li>7.3.   <a href="#rfc.section.7.3">Subscription Expiration</a></li>
<li>7.4.   <a href="#rfc.section.7.4">Implications for Application Reliability</a></li>
</ul><li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Confidentiality from Push Service Access</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Privacy Considerations</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Authorization</a></li>
<li>8.4.   <a href="#rfc.section.8.4">Denial of Service Considerations</a></li>
<li>8.5.   <a href="#rfc.section.8.5">Logging Risks</a></li>
</ul><li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<ul><li>9.1.   <a href="#rfc.section.9.1">Header Field Registrations</a></li>
<li>9.2.   <a href="#rfc.section.9.2">Link Relation URNs</a></li>
</ul><li>10.   <a href="#rfc.section.10">Acknowledgements</a></li>
<li>11.   <a href="#rfc.references">References</a></li>
<ul><li>11.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Change Log</a></li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Since draft-ietf-webpush-protocol-00</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">Many applications on mobile and embedded devices require continuous access to network communications so that real-time events - such as incoming calls or messages - can be delivered (or "pushed") in a timely fashion. These devices typically have limited power reserves, so finding more efficient ways to serve application requirements greatly benefits the application ecosystem.  </p>
<p id="rfc.section.1.p.2">One significant contributor to power usage is the radio.  Radio communications consume a significant portion of the energy budget on a wireless device.  </p>
<p id="rfc.section.1.p.3">Uncoordinated use of persistent connections or sessions from multiple applications can contribute to unnecessary use of the device radio, since each independent session independently incurs overheads.  In particular, keep alive traffic used to ensure that middleboxes do not prematurely time out sessions, can result in significant waste.  Maintenance traffic tends to dominate over the long term, since events are relatively rare.  </p>
<p id="rfc.section.1.p.4">Consolidating all real-time events into a single session ensures more efficient use of network and radio resources.  A single service consolidates all events, distributing those events to applications as they arrive.  This requires just one session, avoiding duplicated overhead costs.  </p>
<p id="rfc.section.1.p.5">The <a href="#API">W3C Web Push API</a> <cite title="NONE">[API]</cite> describes an API that enables the use of a consolidated push service from web applications.  This expands on that work by describing a protocol that can be used to: </p>

<ul>
  <li>request the delivery of a push message to a user agent, </li>
  <li>create new push message delivery subscriptions, and </li>
  <li>monitor for new push messages.  </li>
</ul>

<p> </p>
<p id="rfc.section.1.p.6">Requesting the delivery of events is particularly important for the Web Push API.  The subscription, management and monitoring functions are currently fulfilled by proprietary protocols; these are adequate, but do not offer any of the advantages that standardization affords.  </p>
<p id="rfc.section.1.p.7">This document intentionally does not describe how a push service is discovered.  Discovery of push services is left for future efforts, if it turns out to be necessary at all.  User agents are expected to be configured with a URL for a push service.  </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Conventions and Terminology</a></h1>
<p id="rfc.section.1.1.p.1">In cases where normative language needs to be emphasized, this document falls back on established shorthands for expressing interoperability requirements on implementations: the capitalized words "MUST", "MUST NOT", "SHOULD" and "MAY".  The meaning of these is described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.1.1.p.2">This document defines the following terms: </p>

<dl>
  <dt>application:</dt>
  <dd style="margin-left: 8">Both the sender and ultimate consumer of push messages.  Many applications have components that are run on a user agent and other components that run on servers.  </dd>
  <dt>application server:</dt>
  <dd style="margin-left: 8">The component of an application that runs on a server and requests the delivery of a push message.  </dd>
  <dt>push message subscription:</dt>
  <dd style="margin-left: 8">A message delivery context that is established between the user agent and the push service and shared with the application server.  All push messages are associated with a push message subscription.  </dd>
  <dt>push message:</dt>
  <dd style="margin-left: 8">A message sent from an application server to a user agent via a push service.  </dd>
  <dt>push message receipt:</dt>
  <dd style="margin-left: 8">A message delivery confirmation sent from the push service to the application server.  </dd>
  <dt>push service:</dt>
  <dd style="margin-left: 8">A service that delivers push messages to user agents.  </dd>
  <dt>user agent:</dt>
  <dd style="margin-left: 8">A device and software that is the recipient of push messages.  </dd>
</dl>

<p> </p>
<p id="rfc.section.1.1.p.3">Examples in this document use the <a href="#RFC7230">HTTP/1.1 message format</a> <cite title="NONE">[RFC7230]</cite>.  Many of the exchanges can be completed using HTTP/1.1, where HTTP/2 is necessary, the more verbose frame format from <a href="#RFC7540">[RFC7540]</a> is used.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Overview</h1>
<p id="rfc.section.2.p.1">A general model for push services includes three basic actors: a user agent, a push service, and an application (server).  </p>
<pre>
 +-------+           +--------------+       +-------------+
 |  UA   |           | Push Service |       | Application |
 +-------+           +--------------+       +-------------+
     |                      |                      |
     |      Subscribe       |                      |
     |---------------------&gt;|                      |
     |       Monitor        |                      |
     |&lt;====================&gt;|                      |
     |                      |                      |
     |          Distribute Push Resource           |
     |--------------------------------------------&gt;|
     |                      |                      |
     :                      :                      :
     |                      |     Push Message     |
     |    Push Message      |&lt;---------------------|
     |&lt;---------------------|                      |
     |                      |                      |
</pre>
<p id="rfc.section.2.p.2">At the very beginning of the process, a new  message subscription is created by the user agent and then distributed to its application server. This subscription is the basis of all future interactions between the actors.  </p>
<p id="rfc.section.2.p.3">To offer more control for authorization, a message subscription is modeled as two resources with different capabilities: </p>

<ul>
  <li>A subscription resource is used to receive messages from a subscription and to delete a subscription. It is private to the user agent.  </li>
  <li>A push resource is used to send messages to a subscription. It is public and shared by the user agent with its application server.  </li>
</ul>

<p> </p>
<p id="rfc.section.2.p.4">It is expected that a unique subscription will be distributed to each application; however, there are no inherent cardinality constraints in the protocol.  Multiple subscriptions might be created for the same application, or multiple applications could use the same subscription.  Note however that sharing subscriptions has security and privacy implications.  </p>
<p id="rfc.section.2.p.5">Subscriptions have a limited lifetime.  They can also be terminated by either the push service or user agent at any time. User agents and application servers must be prepared to manage changes in subscription state.  </p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#resources" id="resources">HTTP Resources</a></h1>
<p id="rfc.section.2.1.p.1">This protocol uses <a href="#RFC7230">HTTP resources</a> <cite title="NONE">[RFC7230]</cite> and <a href="#RFC5988">link relations</a> <cite title="NONE">[RFC5988]</cite>.  The following resources are defined: </p>

<dl>
  <dt>push service:</dt>
  <dd style="margin-left: 8">This resource is used to create push message subscriptions (see <a href="#message_subscription">Section 3</a>).  A URL for the push service is configured into user agents.  </dd>
  <dt>push message subscription:</dt>
  <dd style="margin-left: 8">This resource provides read and delete access for a message subscription. A user agent <a href="#monitor">receives push messages</a> <cite title="NONE">[monitor]</cite> using a push message subscription.  Every push message subscription has exactly one push resource associated with it.  </dd>
  <dt>push:</dt>
  <dd style="margin-left: 8">A push resource is used by the application server to request the delivery of a push message (see <a href="#send">Section 5</a>).  A link relation of type "urn:ietf:params:push" is used to identify a push resource.  </dd>
  <dt>push message:</dt>
  <dd style="margin-left: 8">A push message resource is created to identify push messages that have been accepted by the push service.  The push message resource is also used to acknowledge receipt of a push message.  </dd>
  <dt>receipt subscribe:</dt>
  <dd style="margin-left: 8">A receipt subscribe resource is used by an application server to create a receipt subscription (see <a href="#receipt_subscription">Section 4</a>).  A link relation of type "urn:ietf:params:push:receipt" is used to identity a receipt subscribe resource.  </dd>
  <dt>receipt subscription:</dt>
  <dd style="margin-left: 8">An application server <a href="#request_receipt">receives delivery confirmations</a> <cite title="NONE">[request_receipt]</cite> for push messages using a receipt subscription.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#message_subscription" id="message_subscription">Subscribing for Push Messages</a></h1>
<p id="rfc.section.3.p.1">A user agent sends a POST request to its configured push service resource to create a new subscription.  </p>
<pre>
POST /subscribe/ HTTP/1.1
Host: push.example.net

</pre>
<p id="rfc.section.3.p.2">A response with a 201 (Created) status code includes a URI for a new push message subscription resource in the Location header field.  </p>
<p id="rfc.section.3.p.3">The push service MUST provide a URI for the push resource corresponding to the push message subscription using a link relation of type "urn:ietf:params:push".  </p>
<p id="rfc.section.3.p.4">The push service MUST provide a URI for a receipt subscribe resource in a link relation of type "urn:ietf:params:push:receipt".  </p>
<p id="rfc.section.3.p.5">An application-specific method is used to distribute the push and receipt subscribe URIs to the application server.  Confidentiality protection and application server authentication MUST be used to ensure that these URIs are not disclosed to unauthorized recipients (see <a href="#authorization">Section 8.3</a>).  </p>
<pre>
  
HTTP/1.1 201 Created
Date: Thu, 11 Dec 2014 23:56:52 GMT
Link: &lt;/p/JzLQ3raZJfFBR0aqvOMsLrt54w4rJUsV&gt;;
        rel="urn:ietf:params:push"
Link: &lt;/receipts/xjTG79I3VuptNWS0DsFu4ihT97aE6UQJ&gt;;
        rel="urn:ietf:params:push:receipt"
Location: https://push.example.net/s/LBhhw0OohO-Wl4Oi971UGsB7sdQGUibx

</pre>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#receipt_subscription" id="receipt_subscription">Subscribing for Push Message Receipts</a></h1>
<p id="rfc.section.4.p.1">An application server requests the creation of a receipt subscription by sending a HTTP POST request to the receipt subscribe resource distributed to the application server by a user agent.  </p>
<pre>
          
POST /receipts/xjTG79I3VuptNWS0DsFu4ihT97aE6UQJ HTTP/1.1
Host: push.example.net


        </pre>
<p id="rfc.section.4.p.2">A successful response with a 201 (Created) status code includes a URI for the receipt subscription resource in the Location header field.  </p>
<pre>
          
HTTP/1.1 201 Created
Date: Thu, 11 Dec 2014 23:56:52 GMT
Location: https://push.example.net/r/3ZtI4YVNBnUUZhuoChl6omUvG4ZM9mpN


        </pre>
<p id="rfc.section.4.p.3">An application server that sends push messages to a large population of user agents incurs a significant load if it has to monitor a receipt subscription for each user agent.  Reuse of receipt subscriptions is critical in reducing load on application servers.  A receipt subscription can be used for all resources that have the same receipt subscribe URI.  </p>
<p id="rfc.section.4.p.4">A push service SHOULD provide the same receipt subscribe URI to all user agents.  Application servers SHOULD reuse receipt subscription URIs if the receipt subscribe URI provided with the push resource is identical to the one used to create the receipt subscription.  Checking that the receipt subscribe URI is identical allows the application server to avoid creating unnecessary receipt subscriptions.  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#send" id="send">Requesting Push Message Delivery</a></h1>
<p id="rfc.section.5.p.1">An application server requests the delivery of a push message by sending a HTTP request to a push resource distributed to the application server by a user agent. The push message is included in the body of the request.  </p>
<pre>
POST /p/JzLQ3raZJfFBR0aqvOMsLrt54w4rJUsV HTTP/1.1
Host: push.example.net
Push-Receipt: https://push.example.net/r/3ZtI4YVNBnUUZhuoChl6omUvG4ZM9mpN
Content-Type: text/plain;charset=utf8
Content-Length: 36

iChYuI3jMzt3ir20P8r_jgRR-dSuN182x7iB
</pre>
<p>A 201 (Created) response indicates that the push message was accepted.  A URI for the push message resource that was created in response to the request is included in the Location header field.  This does not indicate that the message was delivered to the user agent.  </p>
<pre>
HTTP/1.1 201 Created
Date: Thu, 11 Dec 2014 23:56:55 GMT
Location: https://push.example.net/d/qDIYHNcfAIPP_5ITvURr-d6BGtYnTRnk

</pre>
<p id="rfc.section.5.p.2">A push service MAY generate a 413 (Payload Too Large) status code in response to requests that include an entity body that is too large.  Push services MUST NOT generate a 413 status code in responses to an entity body that is 4k (4096 bytes) or less in size.  </p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#request_receipt" id="request_receipt">Requesting Push Message Receipts</a></h1>
<p id="rfc.section.5.1.p.1">An application server can use the Push-Receipt header field to request a confirmation from the push service when a push message is delivered and acknowledged by the user agent. The Push-Receipt header field is a URI-Reference as defined in Section 2.7 of <a href="#RFC7230">[RFC7230]</a>.  </p>
<pre>
            
Push-Receipt = URI-reference
          
          </pre>
<p id="rfc.section.5.1.p.2">The application sets the Push-Receipt header field value to a receipt subscription URI.  This receipt subscription resource MUST be created from the same receipt subscribe resource which was returned with the push message subscription response (see <a href="#message_subscription">Section 3</a>).  </p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#ttl" id="ttl">Push Message Time-To-Live</a></h1>
<p id="rfc.section.5.2.p.1">A push service can improve the reliability of push message delivery considerably by storing push messages for a period.  User agents are often only intermittently connected, and so benefit from having short term message storage at the push service.  </p>
<p id="rfc.section.5.2.p.2">Delaying delivery might also be used to batch communication with the user agent, thereby conserving radio resources.  </p>
<p id="rfc.section.5.2.p.3">Some push messages are not useful once a certain period of time elapses.  Delivery of messages after they have ceased to be relevant is wasteful.  For example, if the push message contains a call notification, receiving a message after the caller has abandoned the call is of no value; the application at the user agent is forced to suppress the message so that it does not generate a useless alert.  </p>
<p id="rfc.section.5.2.p.4">An application server can use the TTL header field to limit the time that a push message is retained by a push service.  The TTL header field contains a value in seconds that describes how long a push message is retained by the push service.  </p>
<pre>
TTL = 1*DIGIT
          </pre>
<p id="rfc.section.5.2.p.5">Once the Time-To-Live (TTL) period elapses, the push service MUST NOT attempt to deliver the push message to the user agent.  A push service might adjust the TTL value to account for time accounting errors in processing.  For instance, distributing a push message within a server cluster might accrue errors due to clock skew or propagation delays.  </p>
<p id="rfc.section.5.2.p.6">A push service is not obligated to account for time spent by the application server in sending a push message to the push service, or delays incurred while sending a push message to the user agent.  An application server needs to account for transit delays in selecting a TTL header field value.  </p>
<p id="rfc.section.5.2.p.7">Absence of the TTL header field is interpreted as equivalent to a zero value.  A Push message with a zero TTL is immediately delivered if the user agent is available to receive the message. After delivery, the push service is permitted to immediately remove a push message with a zero TTL.  This might occur before the user agent acknowledges receipt of the message by performing a HTTP DELETE on the push message resource. Consequently, an application server cannot rely on receiving acknowledgement receipts for zero TTL push messages.  </p>
<p id="rfc.section.5.2.p.8">If the user agent is unavailable, a push message with a zero TTL expires and is never delivered.  </p>
<p id="rfc.section.5.2.p.9">A push service MAY choose to retain a push message for a shorter duration than that requested.  It indicates this by including a TTL header field in the response that includes the actual TTL.  This TTL value MUST be less than or equal to the value provided by the application server.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#monitor" id="monitor">Receiving Push Messages</a></h1>
<p id="rfc.section.6.p.1">A user agent requests the delivery of new push messages by making a GET request to a push message subscription resource.  The push service does not respond to this request, it instead uses <a href="#RFC7540">HTTP/2 server push</a> <cite title="NONE">[RFC7540]</cite> to send the contents of push messages as they are sent by application servers.  </p>
<p id="rfc.section.6.p.2">Each push message is pushed in response to a synthesized GET request.  The GET request is made to the push message resource that was created by the push service when the application server requested message delivery.  The response body is the entity body from the most recent request sent to the push resource.  </p>
<p>The following example request is made over HTTP/2.  </p>
<pre>
HEADERS      [stream 7] +END_STREAM +END_HEADERS
  :method        = GET
  :path          = /s/LBhhw0OohO-Wl4Oi971UGsB7sdQGUibx
  :authority     = push.example.net
</pre>
<p>The push service permits the request to remain outstanding.  When a push message is sent by an application server, a server push is associated with the initial request.  The response includes the push message.  </p>
<pre>
    
PUSH_PROMISE [stream 7; promised stream 4] +END_HEADERS
  :method        = GET
  :path          = /d/qDIYHNcfAIPP_5ITvURr-d6BGtYnTRnk
  :authority     = push.example.net

HEADERS      [stream 4] +END_HEADERS
  :status        = 200
  date           = Thu, 11 Dec 2014 23:56:56 GMT
  last-modified  = Thu, 11 Dec 2014 23:56:55 GMT
  cache-control  = private
  content-type   = text/plain;charset=utf8
  content-length = 36

DATA         [stream 4] +END_STREAM
  iChYuI3jMzt3ir20P8r_jgRR-dSuN182x7iB
</pre>
<p id="rfc.section.6.p.3">In response to this request, the push service MUST generate a server push for all push messages that have not yet been delivered.  In addition, the push service SHOULD return link references to the push and receipt subscribe resources.  </p>
<p id="rfc.section.6.p.4">A user agent can request the contents of the push message subscription resource immediately by including a <a href="#RFC7240">Prefer header field</a> <cite title="NONE">[RFC7240]</cite> with a "wait" parameter set to "0".  </p>
<p id="rfc.section.6.p.5">A 204 (No Content) status code with no associated server pushes indicates that no messages are presently available.  This could be because push messages have expired.  </p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#acknowledge_message" id="acknowledge_message">Acknowledging Push Messages</a></h1>
<p id="rfc.section.6.1.p.1">To ensure that a push message is properly delivered to the user agent at least once, the user agent MUST acknowledge receipt of the message by performing a HTTP DELETE on the push message resource.  </p>
<pre>
            
DELETE /d/qDIYHNcfAIPP_5ITvURr-d6BGtYnTRnk HTTP/1.1
Host: push.example.net

          </pre>
<p id="rfc.section.6.1.p.2">If the push service receives the acknowledgement and the application has requested a delivery receipt, the push service MUST deliver a success response to the application server monitoring the receipt subscription resource.  </p>
<p id="rfc.section.6.1.p.3">If the push service does not receive the acknowledgement within a reasonable amount of time, then the message is considered to be not yet delivered. The push service SHOULD continue to retry delivery of the message until its advertised expiration.  </p>
<p id="rfc.section.6.1.p.4">The push service MAY cease to retry delivery of the message prior to its advertised expiration due to scenarios such as an unresponsive user agent or operational constraints. If the application has requested a delivery receipt, then the push service MUST deliver a failure response to the application server monitoring the receipt subscription resource.  </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#receive_receipt" id="receive_receipt">Receiving Push Message Receipts</a></h1>
<p id="rfc.section.6.2.p.1">The application server requests the delivery of receipts from the push service by making a HTTP GET request to the receipt subscription resource. The push service does not respond to this request, it instead uses <a href="#RFC7540">HTTP/2 server push</a> <cite title="NONE">[RFC7540]</cite> to send push receipts when messages are acknowledged (<a href="#acknowledge_message">Section 6.1</a>) by the user agent.  </p>
<p id="rfc.section.6.2.p.2">Each receipt is pushed in response to a synthesized GET request.  The GET request is made to the same push message resource that was created by the push service when the application server requested message delivery. A successful response includes a 410 (GONE) status code with no data.  </p>
<p>The following example request is made over HTTP/2.  </p>
<pre>
            
HEADERS      [stream 13] +END_STREAM +END_HEADERS
  :method        = GET
  :path          = /r/3ZtI4YVNBnUUZhuoChl6omUvG4ZM9mpN
  :authority     = push.example.net

          </pre>
<p>The push service permits the request to remain outstanding.  When the user agent acknowledges the message, the push service pushes a delivery receipt to the application server. A 410 (Gone) status code confirms that the message was delivered and acknowledged.  </p>
<pre>
            
PUSH_PROMISE [stream 13; promised stream 82] +END_HEADERS
  :method        = GET
  :path          = /d/qDIYHNcfAIPP_5ITvURr-d6BGtYnTRnk
  :authority     = push.example.net

HEADERS      [stream 4] +END_STREAM
                        +END_HEADERS
  :status        = 410
  date           = Thu, 11 Dec 2014 23:56:56 GMT


          </pre>
<p id="rfc.section.6.2.p.3">If the user agent fails to acknowledge the receipt of the push message and the push service ceases to retry delivery of the message prior to its advertised expiration, then the push service MUST push a failure response with a status code of 5XX (TBD).  </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#operational" id="operational">Operational Considerations</a></h1>
<p id="rfc.section.7.p.1">A push service is likely to have to maintain a very large number of open TCP connections.  Effective management of those connections can depend on being able to move connections between server instances.  </p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#load" id="load">Load Management</a></h1>
<p id="rfc.section.7.1.p.1">A user agent MUST support the 307 (Temporary Redirect) status code <a href="#RFC7231">[RFC7231]</a>, which can be used by a push service to redistribute load at the time that a new subscription is requested.  </p>
<p id="rfc.section.7.1.p.2">A server that wishes to redistribute load can do so using alternative services <a href="#I-D.ietf-httpbis-alt-svc">[I-D.ietf-httpbis-alt-svc]</a>.  Alternative services allows for redistribution of load whilst maintaining the same URIs for various resources.  User agents can ensure a graceful transition by using the GOAWAY frame once it has established a replacement connection.  </p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#storage" id="storage">Push Message Expiration</a></h1>
<p id="rfc.section.7.2.p.1">Storage of push messages based on the TTL header field comprises a potentially significant amount of storage for a push service.  A push service is not obligated to store messages indefinitely.  A push service is able to indicate how long it intends to retain a message to an application server using the TTL header field (see <a href="#ttl">Section 5.2</a>).  </p>
<p id="rfc.section.7.2.p.2">A user agent that does not actively monitor for push messages will not receive messages that expire during that interval.  </p>
<p id="rfc.section.7.2.p.3">Push messages that are stored and not delivered to a user agent are delivered when the user agent recommences monitoring.  Stored push messages SHOULD include a Last-Modified header field (see Section 2.2 of <a href="#RFC7232">[RFC7232]</a>) indicating when delivery was requested by an application server.  </p>
<p id="rfc.section.7.2.p.4">A GET request to a push message subscription resource that has only expired messages results in response as though no push message were ever sent.  </p>
<p id="rfc.section.7.2.p.5">Push services might need to limit the size and number of stored push messages to avoid overloading.  To limit the size of messages, the push service MAY return the 413 (Payload Too Large) status code for messages that are too large. To limit the number of stored push messages, the push service MAY either expire messages prior to their advertised Time-To-Live or reduce their advertised Time-To-Live.  </p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#delete" id="delete">Subscription Expiration</a></h1>
<p id="rfc.section.7.3.p.1">In some cases, it may be necessary to terminate subscriptions so that they can be refreshed.  This applies to both push message subscriptions and receipt subscriptions.  </p>
<p id="rfc.section.7.3.p.2">A push service can remove a subscription at any time. If a user agent or application server has an outstanding request to a subscription resource (see <a href="#monitor">Section 6</a>), this can be signaled by returning a 400-series status code, such as 410 (Gone).  </p>
<p id="rfc.section.7.3.p.3">A user agent or application server can request that a subscription be removed by sending a DELETE request to the push message subscription or receipt subscription URI.  </p>
<p id="rfc.section.7.3.p.4">A push service MUST return a 400-series status code, such as 404 (Not Found) or 410 (Gone) if an application server attempts to send a push message to a removed or expired push message subscription.  </p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> Implications for Application Reliability</h1>
<p id="rfc.section.7.4.p.1">A push service that does not support reliable delivery over intermittent network connections or failing applications on devices, forces the device to acknowledge receipt directly to the application server, incurring additional power drain in order to establish (usually secure) connections to the individual application servers.  </p>
<p id="rfc.section.7.4.p.2">Push message reliability can be important if messages contain information critical to the state of an application.  Repairing state can be costly, particularly for devices with limited communications capacity.  Knowing that a push message has been correctly received avoids costly retransmissions, polling and state resynchronization.  </p>
<p id="rfc.section.7.4.p.3">The availability of push message delivery receipts ensures that the application developer is not tempted to create alternative mechanisms for message delivery in case the push service fails to deliver a critical message. Setting up a polling mechanism or a backup messaging channel in order to compensate for these shortcomings negates almost all of the advantages a push service provides.  </p>
<p id="rfc.section.7.4.p.4">However, reliability might not be necessary for messages that are transient (e.g. an incoming call) or messages that are quickly superceded (e.g. the current number of unread emails).  </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">This protocol MUST use <a href="#RFC2818">HTTP over TLS</a> <cite title="NONE">[RFC2818]</cite>.  This includes any communications between user agent and push service, plus communications between the application and the push service.  All URIs therefore use the "https" scheme.  This provides confidentiality and integrity protection for subscriptions and push messages from external parties.  </p>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> Confidentiality from Push Service Access</h1>
<p id="rfc.section.8.1.p.1">The protection afforded by TLS does not protect content from the push service.  Without additional safeguards, a push service is able to see and modify the content of the messages.  </p>
<p id="rfc.section.8.1.p.2">Applications are able to provide additional confidentiality, integrity or authentication mechanisms within the push message itself.  The application server sending the push message and the application on the user agent that receives it are frequently just different instances of the same application, so no standardized protocol is needed to establish a proper security context.  The process of providing the application server with subscription information provides a convenient medium for key agreement.  </p>
<p id="rfc.section.8.1.p.3">The Web Push API codifies this practice by requiring that each push subscription created by the browser be bound to a browser generated encryption key.  Pushed messages are authenticated and decrypted by the browser before delivery to applications.  This scheme ensures that the push service is unable to examine the contents of push messages.  </p>
<p id="rfc.section.8.1.p.4">The public key for a subscription ensures that applications using that subscription can identify messages from unknown sources and discard them.  This depends on the public key only being disclosed to entities that are authorized to send messages on the channel.  The push service does not require access to this public key.  </p>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> Privacy Considerations</h1>
<p id="rfc.section.8.2.p.1">Push message confidentiality does not ensure that the identity of who is communicating and when they are communicating is protected.  However, the amount of information that is exposed can be limited.  </p>
<p id="rfc.section.8.2.p.2">The URIs provided for push resources MUST NOT provide any basis to correlate communications for a given user agent.  It MUST NOT be possible to correlate any two push resource URIs based solely on their contents.  This allows a user agent to control correlation across different applications, or over time.  </p>
<p id="rfc.section.8.2.p.3">Similarly, the URIs provided by the push service to identify a push message MUST NOT provide any information that allows for correlation across subscriptions.  Push message URIs for the same subscription MAY contain information that would allow correlation with the associated subscription or other push messages for that subscription.  </p>
<p id="rfc.section.8.2.p.4">User and device information MUST NOT be exposed through a push or push message URI.  </p>
<p id="rfc.section.8.2.p.5">In addition, push URIs established by the same user agent or push message URIs for the same subscription MUST NOT include any information that allows them to be correlated with the user agent.  </p>

<dl>
  <dt>Note:</dt>
  <dd style="margin-left: 8">This need not be perfect as long as the resulting anonymity set (see <a href="#RFC6973">[RFC6973]</a>, Section 6.1.1) is sufficiently large.  A push URI necessarily identifies a push service or a single server instance.  It is also possible that traffic analysis could be used to correlate subscriptions.  </dd>
</dl>

<p> </p>
<p id="rfc.section.8.2.p.6">A user agent MUST be able to create new subscriptions with new identifiers at any time.  </p>
<h1 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> <a href="#authorization" id="authorization">Authorization</a></h1>
<p id="rfc.section.8.3.p.1">This protocol does not define how a push service establishes whether a user agent is permitted to create a subscription, or whether push messages can be delivered to the user agent.  A push service MAY choose to authorize requests based on any HTTP-compatible authorization method available, of which there are numerous options.  The authorization process and any associated credentials are expected to be configured in the user agent along with the URI for the push service.  </p>
<p id="rfc.section.8.3.p.2">Authorization is managed using capability URLs for the push message subscription, push, and receipt subscription resources (see <a href="#CAP-URI">[CAP-URI]</a>).  A capability URL grants access to a resource based solely on knowledge of the URL.  </p>
<p id="rfc.section.8.3.p.3">Capability URLs are used for their "easy onward sharing" and "easy client API" properties. These make it possible to avoid relying on relationships between push services and application servers, with the protocols necessary to build and support those relationships.  </p>
<p id="rfc.section.8.3.p.4">Capability URLs act as bearer tokens.  Knowledge of a push message subscription URI implies authorization to either receive push messages or delete the subscription. Knowledge of a push URI implies authorization to send push messages.  Knowledge of a push message URI allows for reading and acknowledging that specific message.  Knowledge of a receipt subscription URI implies authorization to receive push receipts.  Knowledge of a receipt subscribe URI implies authorization to create subscriptions for receipts.  </p>
<p id="rfc.section.8.3.p.5">Note that the same receipt subscribe URI could be returned for multiple push message subscriptions.  Using the same value for a large number of subscriptions allows application servers to reuse receipt subscriptions, which can provide a significant efficiency advantage.  A push service that uses a common receipt subscribe URI loses control over the creation of receipt subscriptions.  This can result in a potential exposure to denial of service; stateless resource creation can be used to mitigate the effects of this exposure.  </p>
<p id="rfc.section.8.3.p.6">Encoding a large amount of random entropy (at least 120 bits) in the path component ensures that it is difficult to successfully guess a valid capability URL.  </p>
<h1 id="rfc.section.8.4"><a href="#rfc.section.8.4">8.4.</a> Denial of Service Considerations</h1>
<p id="rfc.section.8.4.p.1">Discarding unwanted messages at the user agent based on message authentication doesn't protect against a denial of service attack on the user agent.  Even a relatively small volume of push messages can cause battery-powered devices to exhaust power reserves.  </p>
<p id="rfc.section.8.4.p.2">An application can limit where valid push messages can originate by limiting the distribution of push URIs to authorized entities.  Ensuring that push URIs are hard to guess ensures that only application servers that have been given a push URI can use it.  </p>
<p id="rfc.section.8.4.p.3">A malicious application with a valid push URI could use the greater resources of a push service to mount a denial of service attack on a user agent.  Push services SHOULD limit the rate at which push messages are sent to individual user agents.  A push service or user agent MAY <a href="#delete">terminate subscriptions</a> <cite title="NONE">[delete]</cite> that receive too many push messages.  </p>
<p id="rfc.section.8.4.p.4">End-to-end confidentiality mechanisms, such as those in <a href="#API">[API]</a>, prevent an entity with a valid push message subscription URI from learning the contents of push messages.  Push messages that are not successfully authenticated will not be delivered by the API, but this can present a denial of service risk.  </p>
<p id="rfc.section.8.4.p.5">Conversely, a push service is also able to deny service to user agents.  Intentional failure to deliver messages is difficult to distinguish from faults, which might occur due to transient network errors, interruptions in user agent availability, or genuine service outages.  </p>
<h1 id="rfc.section.8.5"><a href="#rfc.section.8.5">8.5.</a> Logging Risks</h1>
<p id="rfc.section.8.5.p.1">Server request logs can reveal subscription-related URIs. Acquiring a push message subscription URI enables the receipt of messages or deletion of the subscription. Acquiring a push URI permits the sending of push messages.  Logging could also reveal relationships between different subscription-related URIs for the same user agent.  Encrypted message contents are not revealed to the push service.  </p>
<p id="rfc.section.8.5.p.2">Limitations on log retention and strong access control mechanisms can ensure that URIs are not learned by unauthorized entities.  </p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">This protocol defines new HTTP header fields in <a href="#iana.header.fields">Section 9.1</a>.  New link relation types are identified using the URNs defined in <a href="#iana.urns">Section 9.2</a>.  </p>
<h1 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1.</a> <a href="#iana.header.fields" id="iana.header.fields">Header Field Registrations</a></h1>
<p id="rfc.section.9.1.p.1">HTTP header fields are registered within the "Message Headers" registry maintained at <span>&lt;</span><a href="https://www.iana.org/assignments/message-headers/">https://www.iana.org/assignments/message-headers/</a><span>&gt;</span>.  </p>
<p id="rfc.section.9.1.p.2">This document defines the following HTTP header fields, so their associated registry entries shall be added according to the permanent registrations below (see <a href="#RFC3864">[RFC3864]</a>): </p>
<div id="rfc.table.1"/>
<div id="iana.header.registration.table"/>
<table cellpadding="3" cellspacing="0" class="tt full left">
  <thead>
    <tr>
      <th class="left">Header Field Name</th>
      <th class="left">Protocol</th>
      <th class="left">Status</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">TTL</td>
      <td class="left">http</td>
      <td class="left">standard</td>
      <td class="left"><a href="#ttl">Section 5.2</a> </td>
    </tr>
    <tr>
      <td class="left">Push-Receipt</td>
      <td class="left">http</td>
      <td class="left">standard</td>
      <td class="left"><a href="#request_receipt">Section 5.1</a> </td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.9.1.p.3">The change controller is: "IETF (iesg@ietf.org) - Internet Engineering Task Force".  </p>
<h1 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2.</a> <a href="#iana.urns" id="iana.urns">Link Relation URNs</a></h1>
<p id="rfc.section.9.2.p.1">This document registers URNs for use in identifying link relation types.  These are added to a new "Web Push Identifiers" registry according to the procedures in Section 4 of <a href="#RFC3553">[RFC3553]</a>; the corresponding "push" sub-namespace is entered in the "IETF URN Sub-namespace for Registered Protocol Parameter Identifiers" registry.  </p>
<p id="rfc.section.9.2.p.2">The "Web Push Identifiers" registry operates under the <a href="#RFC5226">IETF Review policy</a> <cite title="NONE">[RFC5226]</cite>.  </p>

<dl>
  <dt>Registry name:</dt>
  <dd style="margin-left: 8">Web Push Identifiers</dd>
  <dt>URN Prefix:</dt>
  <dd style="margin-left: 8">urn:ietf:params:push</dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">(this document)</dd>
  <dt>Repository:</dt>
  <dd style="margin-left: 8">[Editor/IANA note: please include a link to the final registry location.]</dd>
  <dt>Index value:</dt>
  <dd style="margin-left: 8">Values in this registry are URNs or URN prefixes that start with the prefix <samp>urn:ietf:params:push</samp>.  Each is registered independently.</dd>
</dl>

<p> </p>
<p id="rfc.section.9.2.p.3">New registrations in the "Web Push Identifiers" are encouraged to include the following information: </p>

<dl>
  <dt>URN:</dt>
  <dd style="margin-left: 8">A complete URN or URN prefix.</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">A summary description.</dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">A reference to a specification describing the semantics of the URN or URN prefix.</dd>
  <dt>Contact:</dt>
  <dd style="margin-left: 8">Email for the person or group making the registration.</dd>
  <dt>Index value:</dt>
  <dd style="margin-left: 8">As described in <a href="#RFC3553">[RFC3553]</a>, URN prefixes that are registered include a description of how the URN is constructed.  This is not applicable for specific URNs.</dd>
</dl>

<p> </p>
<p id="rfc.section.9.2.p.4">These values are entered as the initial content of the "Web Push Identifiers" registry.  </p>
<p/>

<dl>
  <dt>URN:</dt>
  <dd style="margin-left: 8">urn:ietf:params:push</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">This link relation type is used to identify a resource for sending push messages.</dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">(this document)</dd>
  <dt>Contact:</dt>
  <dd style="margin-left: 8">The Web Push WG (webpush@ietf.org)</dd>
</dl>

<p> </p>
<p/>

<dl>
  <dt>URN:</dt>
  <dd style="margin-left: 8">urn:ietf:params:push:receipt</dd>
  <dt>Description:</dt>
  <dd style="margin-left: 8">This link relation type is used to identify a resource for creating new push message receipt subscriptions.  </dd>
  <dt>Specification:</dt>
  <dd style="margin-left: 8">(this document)</dd>
  <dt>Contact:</dt>
  <dd style="margin-left: 8">The Web Push WG (webpush@ietf.org)</dd>
</dl>

<p> </p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.10.p.1">Significant technical input to this document has been provided by Costin Manolache, Robert Sparks, Mark Nottingham, Matthew Kaufman and many others.  </p>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="CAP-URI">[CAP-URI]</b>
      </td>
      <td class="top"><a>Tennison, J.</a>, "<a href="http://www.w3.org/TR/capability-urls/">Good Practices for Capability URLs</a>", FPWD capability-urls, February 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-httpbis-alt-svc">[I-D.ietf-httpbis-alt-svc]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a>, <a>McManus, P.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/draft-ietf-httpbis-alt-svc-07">HTTP Alternative Services</a>", Internet-Draft draft-ietf-httpbis-alt-svc-07, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2818">[RFC2818]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, May 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3553">[RFC3553]</b>
      </td>
      <td class="top"><a>Mealling, M.</a>, <a>Masinter, L.</a>, <a>Hardie, T.</a> and <a>G. Klyne</a>, "<a href="http://tools.ietf.org/html/rfc3553">An IETF URN Sub-namespace for Registered Protocol Parameters</a>", BCP 73, RFC 3553, June 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3864">[RFC3864]</b>
      </td>
      <td class="top"><a>Klyne, G.</a>, <a>Nottingham, M.</a> and <a>J. Mogul</a>, "<a href="http://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>", BCP 90, RFC 3864, September 2004.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5226">[RFC5226]</b>
      </td>
      <td class="top"><a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, May 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5988">[RFC5988]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a>, "<a href="http://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, October 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7230">[RFC7230]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7231">[RFC7231]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7232">[RFC7232]</b>
      </td>
      <td class="top"><a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests</a>", RFC 7232, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7240">[RFC7240]</b>
      </td>
      <td class="top"><a>Snell, J.</a>, "<a href="http://tools.ietf.org/html/rfc7240">Prefer Header for HTTP</a>", RFC 7240, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7540">[RFC7540]</b>
      </td>
      <td class="top"><a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2</a>", RFC 7540, May 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="API">[API]</b>
      </td>
      <td class="top"><a>Sullivan, B.</a>, <a>Fullea, E.</a> and <a>M. van Ouwerkerk</a>, "<a href="https://w3c.github.io/push-api/">Web Push API</a>", ED push-api, February 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6973">[RFC6973]</b>
      </td>
      <td class="top"><a>Cooper, A.</a>, <a>Tschofenig, H.</a>, <a>Aboba, B.</a>, <a>Peterson, J.</a>, <a>Morris, J.</a>, <a>Hansen, M.</a> and <a>R. Smith</a>, "<a href="http://tools.ietf.org/html/rfc6973">Privacy Considerations for Internet Protocols</a>", RFC 6973, July 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> Change Log</h1>
<p id="rfc.section.A.p.1">[[The RFC Editor is requested to remove this section at publication.]]</p>
<h1 id="rfc.appendix.A.1"><a href="#rfc.appendix.A.1">A.1.</a> <a href="#changes.since.draft-ietf-webpush-protocol-00" id="changes.since.draft-ietf-webpush-protocol-00">Since draft-ietf-webpush-protocol-00</a></h1>
<p id="rfc.section.A.1.p.1">Editorial changes for Push Message Time-To-Live </p>
<p id="rfc.section.A.1.p.2">Editorial changes for Push Acknowledgements </p>
<p id="rfc.section.A.1.p.3">Removed subscription expiration based on HTTP cache headers </p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  <span class="vcardline">331 E Evelyn Street</span>

	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code">94041</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Elio Damaggio</span> 
	  <span class="n hidden">
		<span class="family-name">Damaggio</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  <span class="vcardline">One Microsoft Way</span>

	  <span class="vcardline">
		<span class="locality">Redmond</span>,  
		<span class="region">WA</span> 
		<span class="code">98052</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:elioda@microsoft.com">elioda@microsoft.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Raymor</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Raymor</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  <span class="vcardline">One Microsoft Way</span>

	  <span class="vcardline">
		<span class="locality">Redmond</span>,  
		<span class="region">WA</span> 
		<span class="code">98052</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:brian.raymor@microsoft.com">brian.raymor@microsoft.com</a></span>

  </address>
</div>

</body>
</html>
